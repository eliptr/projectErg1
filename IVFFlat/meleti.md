# Πειραματική Μελέτη Αλγορίθμου IVFFlat

Η παρούσα ενότητα αναλύει την επίδραση των βασικών παραμέτρων του αλγορίθμου **IVFFlat** στην ακρίβεια και την απόδοση αναζήτησης.  
Η αξιολόγηση έγινε χρησιμοποιώντας τα σύνολα **MNIST** και **SIFT**, μετρώντας τις εξής επιδόσεις:

- **Average Approximation Factor (AAF)** — μέτρο προσέγγισης μεταξύ προσεγγιστικής και πραγματικής απόστασης.  
- **Recall@N** — ποσοστό των πραγματικών πλησιέστερων γειτόνων που ανακτώνται.  
- **Queries Per Second (QPS)** — ρυθμός αναζητήσεων ανά δευτερόλεπτο.
- **Silhouette score** — εύρεση βέλτιστου kclusters

---

## Παράμετροι Πειραμάτων

| Παράμετρος  | Περιγραφή                                 | Τυπικές τιμές 
|-------------|-------------------------------------------|----------------
| `kclusters` | Αριθμός συστάδων του k-means              | 50–200 (MNIST), 256–1024 (SIFT) 
| `nprobe`    | Πλήθος συστάδων που εξετάζονται ανά query | 1–20 
| `N`         | Πλήθος πλησιέστερων γειτόνων              | 1–100 
| `R`         | Ακτίνα για range search                   | 2000 (MNIST), 2 (SIFT) 
| `seed`      | Αρχικοποίηση ψευδοτυχαίων αριθμών         | 1 (default) 

---

## 1. Επίδραση του **kclusters**

Ο αριθμός των συστάδων καθορίζει τη λεπτομέρεια με την οποία διαμερίζεται ο χώρος.

- **Μικρό kclusters** (π.χ. 20–50):
  - Οι συστάδες είναι μεγάλες → περισσότερα σημεία ανά cluster.
  - Η αναζήτηση είναι ταχύτερη (λιγότερα centroids προς εξέταση).
  - Όμως, αυξάνει η πιθανότητα λανθασμένου εντοπισμού → **χαμηλότερη Recall**, **υψηλότερο AF**.

- **Μεγάλο kclusters** (π.χ. 1000–4000):
  - Οι συστάδες είναι πιο “λεπτές”.
  - Η ακρίβεια αυξάνεται (Recall↑, AF↓).
  - Ο χρόνος αναζήτησης και εκπαίδευσης αυξάνεται.

>  **Συμπέρασμα:** Η αύξηση του `kclusters` βελτιώνει την ακρίβεια εις βάρος της ταχύτητας.  
> Η βέλτιστη τιμή εντοπίζεται μέσω της μετρικής **silhouette**, γύρω από 100–200 για MNIST και 1000–2000 για SIFT.

---

## 2. Επίδραση του **nprobe**

Η παράμετρος `nprobe` καθορίζει πόσες συστάδες εξετάζονται κατά την αναζήτηση.

- **Μικρό nprobe** → πολύ γρήγορη αναζήτηση, χαμηλή ακρίβεια.  
- **Μεγάλο nprobe** → περισσότερα υποψήφια σημεία → υψηλότερη Recall, μικρότερο AF, αλλά χαμηλότερο QPS.


Ανάλογο του αριθμού συστάδων
**Εμπειρικά:**
- SIFT: kclusters = 256: nprobe = 5 → Recall ≈ 0.70, nprobe = 20 → Recall ≈ 0.95.  
Βέλτιστη απόδοση περίπου στο 10% των συστάδων
>  **Συμπέρασμα:** Το `nprobe` είναι ο κύριος ρυθμιστής του συμβιβασμού **ταχύτητας ↔ ακρίβειας**.

---

## 3. Επίδραση του **N**

Η παράμετρος `N` καθορίζει πόσοι πλησιέστεροι γείτονες επιστρέφονται ανά query.

- Για μικρό `N` (π.χ. 1), το πρόβλημα είναι απλούστερο:  
  το Recall@1 είναι συχνά υψηλό, καθώς ο αλγόριθμος χρειάζεται να βρει μόνο τον απολύτως κοντινότερο γείτονα.  
- Όταν το `N` αυξάνεται (π.χ. 10, 100), ο αλγόριθμος πρέπει να ανακτήσει σωστά *περισσότερους* γείτονες.  
  Έτσι, το **Recall@N** τείνει να μειώνεται.
- Παράλληλα, ο **Average Approximation Factor (AAF)** αυξάνεται,  
  καθώς στο σύνολο των Ν αποτελεσμάτων περιλαμβάνονται και πιο μακρινοί, λιγότερο ακριβείς γείτονες.

> 📉 **Συμπέρασμα:**  
> - Η αύξηση του `N` αυξάνει το υπολογιστικό κόστος,  
> - μειώνει ελαφρώς το Recall,  
> - και οδηγεί σε μεγαλύτερο μέσο λόγο προσέγγισης (AAF).

---

## 4. Επίδραση του **R** (Range Search)

Η παράμετρος `R` καθορίζει την ακτίνα της αναζήτησης περιοχής.

- **Μικρό R:** λίγα ή καθόλου αποτελέσματα, υψηλό QPS αλλά χαμηλή κάλυψη.  
- **Μεγάλο R:** περισσότερα αποτελέσματα, υψηλότερο Recall, αλλά αυξημένος χρόνος επεξεργασίας.

> 🔧 Για MNIST: R ≈ 2000  
> 🔧 Για SIFT: R ≈ 2

---


## 6. Συνολική Παρατήρηση

Η μεταβολή των παραμέτρων παρουσιάζει τις εξής συσχετίσεις:

| Μεταβολή    | Recall | AAF | QPS | Παρατήρηση 
|-------------|--------|-----|-----|-------------
| ↑ kclusters | ↑      | ↓   | ↓   | Περισσότερη ακρίβεια, μικρότερη ταχύτητα. Για να αυξηθεί η ακρίβεια προυποθέτει να αυξηθεί και το nprobe
| ↑ nprobe    | ↑      | ↓   | ↓   | Βελτίωση Recall με γραμμική αύξηση κόστους 
| ↑ N         | ↓      | ↑   | -   | Όσο αυξάνεται, μειώνεται η ακρίβεια

---

## 7. Ενδεικτικός Πίνακας Αποτελεσμάτων (SIFT Dataset)

| kclusters  | nprobe | Recall@10  | AAF    | QPS   | SpeedUp |
|------------|--------|------------|--------|-------|---------|
| 256        | 5      | 0.75       | 1.013  | 19600 | 21x     | 
| 256        | 10     | 0.89       | 1.004  | 12400 | 13x     |
| 512        | 10     | 0.83       | 1.007  | 12400 | 13x     |
| 512        | 20     | 0.94       | 1.002  | 8700  | 9x      |

(Speed compared to brute-force)

Παρατηρείται ότι η αύξηση της ακρίβειας συνοδεύεται από μείωση του ρυθμού αναζήτησης.

---

## 8. Συμπεράσματα

- Ο **IVFFlat** προσφέρει σημαντική επιτάχυνση έναντι της πλήρους αναζήτησης (brute-force),  
  με μικρή απώλεια ακρίβειας όταν επιλεγούν κατάλληλες τιμές παραμέτρων.
- Η **μετρική silhouette** βοηθά στην εύρεση του βέλτιστου αριθμού συστάδων.
- Οι παράμετροι **nprobe** και **kclusters** ελέγχουν άμεσα τον συμβιβασμό  
  μεταξύ **ακρίβειας** και **χρόνου απόκρισης**.
- Η τελική επιλογή παραμέτρων εξαρτάται από τις απαιτήσεις της εφαρμογής:  
  **υψηλή ακρίβεια** ή **υψηλή ταχύτητα αναζήτησης**.

---

*Η πειραματική διαδικασία πραγματοποιήθηκε χρησιμοποιώντας τον αλγόριθμο IVFFlat με Ευκλείδεια μετρική (L2),  
σε datasets MNIST και SIFT, με εκτέλεση πολλαπλών δοκιμών για διαφορετικούς συνδυασμούς παραμέτρων.*
